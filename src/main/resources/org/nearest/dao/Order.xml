<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="org.nearest.dao.OrderDao">
  <resultMap type="order" id="orderMap">
    <id     column="order_no"       property="no" />
    <result column="order_dt"       property="orderDate" />
    <result column="order_st"      property="orderState" />
    <association property="mart" javaType="mart">
      <result column="mt_no" property="no" javaType="INTEGER"/>
    </association>
    <association property="client" javaType="client">
      <result column="clnt_no" property="no" javaType="INTEGER"/>
    </association>
  </resultMap>
  
  <insert id="insertOrder" parameterType="map">
    insert into 
    orders (order_dt, order_st, mt_no, clnt_no) 
    values 
      <foreach collection="noDuplMartNo" item="item" separator=",">
         ( now(), 1, #{item}, #{clientNo})  
      </foreach>
    <selectKey resultType="int" keyProperty="orderNo" order="AFTER">
      SELECT LAST_INSERT_ID();
    </selectKey>
  </insert>
  
  <select id="selectOrderCount" resultType="java.util.HashMap" parameterType="int">
	  select distinct
			(select count(*) from orders where ORDER_ST = 1 and clnt_no = #{value}) as paid,
			(select count(*) from orders where ORDER_ST = 2 and clnt_no = #{value}) as preparing,
			(select count(*) from orders where ORDER_ST = 3 and clnt_no = #{value}) as complete,
			(select count(*) from orders where ORDER_ST = 4 and clnt_no = #{value}) as received
		from orders
  </select>

  

</mapper>